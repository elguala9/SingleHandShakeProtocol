"use strict";var er=Object.create;var rt=Object.defineProperty;var tr=Object.getOwnPropertyDescriptor;var rr=Object.getOwnPropertyNames;var sr=Object.getPrototypeOf,nr=Object.prototype.hasOwnProperty;var m=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports);var ir=(r,e,t,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of rr(e))!nr.call(r,n)&&n!==t&&rt(r,n,{get:()=>e[n],enumerable:!(s=tr(e,n))||s.enumerable});return r};var or=(r,e,t)=>(t=r!=null?er(sr(r)):{},ir(e||!r||!r.__esModule?rt(t,"default",{value:r,enumerable:!0}):t,r));var B=m(te=>{"use strict";Object.defineProperty(te,"__esModule",{value:!0});function ar(r,e){for(var t in e)Object.defineProperty(r,t,{enumerable:!0,get:Object.getOwnPropertyDescriptor(e,t).get})}ar(te,{get END_MARKER_PREFIX(){return nt},get START_MARKER_PREFIX(){return st},get endMarker(){return cr},get startMarker(){return ur}});var st="## WORKER:START:",nt="## WORKER:END:";function ur(r){return`${st}${r}`}function cr(r){return`${nt}${r}`}});var it=m(re=>{"use strict";Object.defineProperty(re,"__esModule",{value:!0});Object.defineProperty(re,"registerWorker",{enumerable:!0,get:function(){return dr}});var $=require("worker_threads"),G=B();function dr(r){var s;(s=$.parentPort)==null||s.on("message",async n=>{let i;switch(n.type){case"start":return i=new AbortController,n.task&&await e(n.id,n.task,i.signal);case"abort":return i==null?void 0:i.abort();case"check-memory-usage":return t($.parentPort)}});async function e(n,i,o){var u,c;try{process.stdout.write(`${(0,G.startMarker)(n)}
`),process.stderr.write(`${(0,G.startMarker)(n)}
`);let a=await r(i,o);(u=$.parentPort)==null||u.postMessage({type:"status",err:void 0,results:a})}catch(a){(c=$.parentPort)==null||c.postMessage({type:"status",err:a,results:void 0})}finally{process.stdout.write(`${(0,G.endMarker)(n)}
`),process.stderr.write(`${(0,G.endMarker)(n)}
`)}}function t(n){let i={type:"report-memory-usage",memoryUsage:process.memoryUsage().heapUsed};n.postMessage(i)}}});var ot=m(se=>{"use strict";Object.defineProperty(se,"__esModule",{value:!0});Object.defineProperty(se,"createFilteredStreamTransform",{enumerable:!0,get:function(){return lr}});var pr=require("stream"),U=B();function lr(){return new pr.Transform({transform(e,t,s){let n=e.toString();n.includes(U.START_MARKER_PREFIX)&&(n=n.replace(new RegExp(U.START_MARKER_PREFIX+`[0-9a-z]{64}
`),"")),n.includes(U.END_MARKER_PREFIX)&&(n=n.replace(new RegExp(U.END_MARKER_PREFIX+`[0-9a-z]{64}
`),"")),s(null,n)}})}});var at=m(ie=>{"use strict";Object.defineProperty(ie,"__esModule",{value:!0});Object.defineProperty(ie,"TaskInfo",{enumerable:!0,get:function(){return ne}});var fr=require("async_hooks");function hr(r,e,t){return e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}var ne=class extends fr.AsyncResource{get id(){return this.options.id}get weight(){return this.options.weight}get abortSignal(){return this.options.abortSignal}done(e,t){let{cleanup:s,worker:n,resolve:i,reject:o}=this.options;s&&this.runInAsyncScope(s,null,n),e?this.runInAsyncScope(o,null,e,n):this.runInAsyncScope(i,null,t,n),this.emitDestroy()}constructor(e){super("WorkerPoolTaskInfo"),hr(this,"options",void 0),this.options=e,e.setup&&this.runInAsyncScope(e.setup,null,e.worker,e.worker.stdout,e.worker.stderr)}}});var _t=m(de=>{"use strict";Object.defineProperty(de,"__esModule",{value:!0});Object.defineProperty(de,"ThreadWorker",{enumerable:!0,get:function(){return ue}});var ut=ot(),ct=require("readline"),dt=B(),gr=require("events"),pt=require("stream"),yr=at(),mr=require("worker_threads"),_r=yt(require("crypto")),wr=yt(require("v8"));function ht(r,e){if(e.has(r))throw new TypeError("Cannot initialize the same private elements twice on an object")}function kr(r,e){return e.get?e.get.call(r):e.value}function vr(r,e,t){if(e.set)e.set.call(r,t);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=t}}function gt(r,e,t){if(!e.has(r))throw new TypeError("attempted to "+t+" private field on non-instance");return e.get(r)}function h(r,e){var t=gt(r,e,"get");return kr(r,t)}function z(r,e,t){ht(r,e),e.set(r,t)}function A(r,e,t){var s=gt(r,e,"set");return vr(r,s,t),t}function I(r,e,t){if(!e.has(r))throw new TypeError("attempted to get private field on non-instance");return t}function H(r,e){ht(r,e),e.add(r)}function F(r,e,t){return e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function yt(r){return r&&r.__esModule?r:{default:r}}var Pr="free",br=wr.default.getHeapStatistics().total_available_size,M=new WeakMap,R=new WeakMap,E=new WeakMap,O=new WeakMap,oe=new WeakSet,ae=new WeakSet,mt=new WeakSet,V=new WeakSet,ue=class extends gr.EventEmitter{start(e,t){this.status="busy";let{task:s,resolve:n,reject:i,cleanup:o,setup:u}=e;t==null||t.addEventListener("abort",I(this,V,ce));let c=_r.default.randomBytes(32).toString("hex");A(this,M,new yr.TaskInfo({id:c,weight:e.weight,cleanup:o,resolve:n,reject:i,worker:this,setup:u,abortSignal:t})),h(this,R).promise=new Promise(a=>{h(this,R).resolve=a}),h(this,E).promise=new Promise(a=>{h(this,E).resolve=a}),h(this,O).postMessage({type:"start",task:{...s,weight:e.weight},id:c})}get weight(){var e;return((e=h(this,M))==null?void 0:e.weight)??1}get stdout(){return h(this,R).stream}get stderr(){return h(this,E).stream}get resourceLimits(){return h(this,O).resourceLimits}get threadId(){return h(this,O).threadId}terminate(){h(this,O).removeAllListeners(),h(this,O).terminate(),h(this,O).unref()}restart(){this.restarts++,this.status="busy",h(this,O).terminate(),I(this,oe,lt).call(this)}async checkMemoryUsage(){h(this,O).postMessage({type:"check-memory-usage"})}postMessage(e,t){h(this,O).postMessage(e,t)}constructor(e,t){super(),H(this,oe),H(this,ae),H(this,mt),H(this,V),F(this,"script",void 0),F(this,"options",void 0),z(this,M,{writable:!0,value:void 0}),z(this,R,{writable:!0,value:void 0}),z(this,E,{writable:!0,value:void 0}),z(this,O,{writable:!0,value:void 0}),F(this,"status",void 0),F(this,"restarts",void 0),F(this,"maxWorkerMemoryUsage",void 0),this.script=e,this.options=t,A(this,R,{stream:new pt.Readable,promise:Promise.resolve(),resolve:()=>{}}),A(this,E,{stream:new pt.Readable,promise:Promise.resolve(),resolve:()=>{}}),this.status="busy",this.restarts=0,this.maxWorkerMemoryUsage=0,t.workerIdleMemoryLimitPercentage||(t.workerIdleMemoryLimitPercentage=80),I(this,oe,lt).call(this)}};function lt(){let{workerOptions:r}=this.options,e=this.script,t=new mr.Worker(e,{...r,stdout:!0,stderr:!0});I(this,mt,Tr).call(this,t);let s=t.stdout.pipe((0,ut.createFilteredStreamTransform)()),n=t.stderr.pipe((0,ut.createFilteredStreamTransform)()),i=()=>{},o=new Promise(p=>{i=p,p()}),u=()=>{},c=new Promise(p=>{u=p,p()}),a=p=>{var y;if(p.type==="status")Promise.all([h(this,R).promise,h(this,E).promise]).then(()=>{var l;let{err:k,results:v}=p;h(this,M)&&((l=h(this,M).abortSignal)==null||l.removeEventListener("abort",I(this,V,ce)),h(this,M).done(k,v)),this.checkMemoryUsage()});else if(p.type==="report-memory-usage"){this.maxWorkerMemoryUsage=Math.max(this.maxWorkerMemoryUsage,p.memoryUsage);let k=(y=h(this,O).resourceLimits)==null?void 0:y.maxOldGenerationSizeMb,v=this.options.workerIdleMemoryLimit??(k?k*1024*1024:br)*this.options.workerIdleMemoryLimitPercentage/100;v&&p.memoryUsage>v?this.restart():I(this,ae,ft).call(this)}else this.emit("message",p)};t.on("message",a);let d=p=>{var y;h(this,R).resolve(),h(this,E).resolve(),h(this,M)?((y=h(this,M).abortSignal)==null||y.removeEventListener("abort",I(this,V,ce)),h(this,M).done(p,null)):this.emit("error",p)};t.on("error",d),A(this,O,t),A(this,R,{stream:s,promise:o,resolve:i}),A(this,E,{stream:n,promise:c,resolve:u}),I(this,ae,ft).call(this)}function ft(){let r=1;h(this,M)&&(r=h(this,M).weight,A(this,M,void 0)),this.status="free",this.emit(Pr,{weight:r})}function Tr(r){let e=r.stdout,t=(0,ct.createInterface)({input:e,crlfDelay:1/0}),s=r.stderr,n=(0,ct.createInterface)({input:s,crlfDelay:1/0}),i=c=>{let a=[],d;return p=>{h(this,M)&&(p.includes((0,dt.startMarker)(h(this,M).id))?(a=[],c==="stdout"?d=h(this,R).resolve:d=h(this,E).resolve):p.includes((0,dt.endMarker)(h(this,M).id))?d():a.push(p))}},o=i("stdout"),u=i("stderr");t.on("line",o),n.on("line",u)}function ce(){h(this,O)&&h(this,O).postMessage({type:"abort"})}});var wt=m(pe=>{"use strict";Object.defineProperty(pe,"__esModule",{value:!0});Object.defineProperty(pe,"pickTaskFromQueue",{enumerable:!0,get:function(){return Or}});function Mr(r,e){return!!(!r||e.priority&&(r.priority==null||e.priority>r.priority))}function Or(r,e){let t,s;for(let n=0;n<r.length;n++){let i=r[n];i.weight<=e&&Mr(s==null?void 0:s.queueItem,i)&&(s={queueItem:i,index:n}),i.priority!==void 0&&(t=t!==void 0?Math.max(t,i.priority):i.priority)}return s&&(t===void 0||s.queueItem.priority===t)?s.index:-1}});var he=m(fe=>{"use strict";Object.defineProperty(fe,"__esModule",{value:!0});function Sr(r,e){for(var t in e)Object.defineProperty(r,t,{enumerable:!0,get:Object.getOwnPropertyDescriptor(e,t).get})}Sr(fe,{get WorkerPool(){return le},get WorkerPoolEvents(){return K}});var Wr=require("events"),Rr=_t(),Er=wt(),xr=Ir(require("os"));function C(r,e,t){return e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function Ir(r){return r&&r.__esModule?r:{default:r}}var K={freedWorker:"freedWorker",idle:"idle",busy:"busy",restarting:"restarting"},le=class extends Wr.EventEmitter{isIdle(){return this.workers.every(e=>e.status==="free")}get workerRestarts(){return this.workers.reduce((e,t)=>e+t.restarts,0)}get maxWorkerMemoryUsage(){return this.workers.reduce((e,t)=>Math.max(e,t.maxWorkerMemoryUsage),0)}stats(){return{maxWorkerMemoryUsage:this.maxWorkerMemoryUsage,workerRestarts:this.workerRestarts}}createInitialWorkers(){if(this.workers.length===0)for(let e=0;e<this.minWorkers;e++)this.addNewWorker()}addNewWorker(){if(this.workers.length<=this.maxWorkers){let{script:e,workerOptions:t}=this.options,s=new Rr.ThreadWorker(e,{workerOptions:t,workerIdleMemoryLimit:this.options.workerIdleMemoryLimit});return s.on("free",n=>{let{weight:i}=n;this.availability+=i,this.emit(K.freedWorker)}),this.workers.push(s),s}}exec(e,t,s,n,i,o){return i!=null&&i.aborted?Promise.resolve():(t=Math.min(Math.max(1,t),this.maxWorkers),new Promise((u,c)=>{this.queue.push({task:{...e,weight:t},weight:t,resolve:u,reject:c,cleanup:n,setup:s,priority:o}),this._exec(i)}))}_exec(e){let t=(0,Er.pickTaskFromQueue)(this.queue,this.availability);if(t===-1)return;let s=this.workers.find(n=>n.status==="free");if(s||(s=this.addNewWorker()),s){let n=this.queue[t];this.queue.splice(t,1),this.availability-=n.weight,s.start(n,e)}}async close(){await Promise.all(this.workers.map(e=>e.terminate()))}constructor(e){super(),C(this,"options",void 0),C(this,"workers",void 0),C(this,"freeWorkers",void 0),C(this,"queue",void 0),C(this,"minWorkers",void 0),C(this,"maxWorkers",void 0),C(this,"availability",void 0),this.options=e,this.workers=[],this.freeWorkers=[],this.queue=[],this.minWorkers=0,this.maxWorkers=0,this.availability=0,this.minWorkers=this.options.minWorkers??2,this.maxWorkers=this.options.maxWorkers??xr.default.cpus().length-1,this.availability=this.maxWorkers,this.workers=[],this.freeWorkers=[],this.queue=[],this.createInitialWorkers(),this.on(K.freedWorker,()=>{this.queue.length>0?(this._exec(),this.emit(K.busy)):this.isIdle()&&this.emit(K.idle)})}}});var kt=m(me=>{"use strict";Object.defineProperty(me,"__esModule",{value:!0});Object.defineProperty(me,"AggregatedPool",{enumerable:!0,get:function(){return ye}});var X=he(),Dr=qr(require("events"));function ge(r,e,t){return e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function qr(r){return r&&r.__esModule?r:{default:r}}var ye=class extends Dr.default{stats(){return[...this.groupedPools.values(),this.defaultPool].reduce((t,s)=>{if(s){let n=s.stats();t.maxWorkerMemoryUsage=Math.max(t.maxWorkerMemoryUsage,n.maxWorkerMemoryUsage),t.workerRestarts=t.workerRestarts+n.workerRestarts}return t},{maxWorkerMemoryUsage:0,workerRestarts:0})}async exec(e,t,s,n,i,o){let u=this.options.groupBy(e),c=this.groupedPools.get(u)??this.defaultPool;if(!c)throw new Error(`No pool found to be able to run ${u} tasks, try adjusting the maxWorkers & concurrency values`);return c.exec(e,t,s,n,i,o)}async close(){let e=[...this.groupedPools.values(),this.defaultPool].map(t=>t==null?void 0:t.close());return Promise.all(e)}constructor(e){super(),ge(this,"options",void 0),ge(this,"groupedPools",void 0),ge(this,"defaultPool",void 0),this.options=e,this.groupedPools=new Map;let{maxWorkers:t,maxWorkersByGroup:s,script:n,workerOptions:i}=e,o=0;for(let[a,d]of s.entries()){let p=new X.WorkerPool({maxWorkers:d,workerOptions:i,script:n,workerIdleMemoryLimit:e.workerIdleMemoryLimit});this.groupedPools.set(a,p),o+=d}if(o>t)throw new Error(`Total maxWorkers (${o}) configured across all groups exceeds concurrency (${t}). Try reducing the maxWorkers, or increasing the --concurrency CLI argument, or separate the tasks to be run`);let u=t-o;u>0&&(this.defaultPool=new X.WorkerPool({maxWorkers:u,workerOptions:i,script:n,workerIdleMemoryLimit:e.workerIdleMemoryLimit})),this.options.logger.verbose(`Workers pools created:  ${[...s.entries(),["default",u]].map(([a,d])=>`${a} (${d})`).join(", ")}`);let c=[...this.groupedPools.values(),this.defaultPool];c.forEach(a=>{a==null||a.on(X.WorkerPoolEvents.idle,()=>{c.every(d=>d==null?void 0:d.isIdle())&&this.emit(X.WorkerPoolEvents.idle)})})}}});var vt=m(_e=>{"use strict";Object.defineProperty(_e,"__esModule",{value:!0});function Ar(r,e){for(var t in e)Object.defineProperty(r,t,{enumerable:!0,get:Object.getOwnPropertyDescriptor(e,t).get})}Ar(_e,{get AggregatedPool(){return jr.AggregatedPool},get WorkerPool(){return Nr.WorkerPool},get registerWorker(){return Cr.registerWorker}});var Cr=it(),Nr=he(),jr=kt()});var bt=m(we=>{"use strict";Object.defineProperty(we,"__esModule",{value:!0});Object.defineProperty(we,"NpmScriptRunner",{enumerable:!0,get:function(){return J}});var Fr=require("path"),Kr=require("fs/promises"),Lr=require("child_process"),Br=$r(require("os"));function Pt(r,e,t){return e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function $r(r){return r&&r.__esModule?r:{default:r}}var J=class r{getNpmArgs(e,t){let s=t.length>0?["--",...t]:[];return["run",e,...s]}async hasNpmScript(e){var i,o;let t=((i=e.options)==null?void 0:i.script)??e.task,s=(0,Fr.join)(e.cwd,"package.json");return!!((o=JSON.parse(await(0,Kr.readFile)(s,"utf8")).scripts)!=null&&o[t])}async shouldRun(e){return await this.hasNpmScript(e)&&(e.shouldRun??!0)}async run(e){var k,v,l;let{target:t,weight:s,abortSignal:n}=e,{nodeOptions:i,npmCmd:o,taskArgs:u}=this.options,c=((k=t.options)==null?void 0:k.script)??t.task,a;if(n){if(n.aborted)return{exitCode:1};let g=()=>{if(n.removeEventListener("abort",g),a&&!a.killed){let T=a.pid;process.stdout.write(`Abort signal detected, attempting to killing process id ${T}
`),a.kill("SIGTERM");let b=setTimeout(()=>{a&&!a.killed&&a.kill("SIGKILL")},r.gracefulKillTimeout);b.unref&&b.unref()}};n.addEventListener("abort",g)}let d=[...u,...((v=t.options)==null?void 0:v.taskArgs)??[]],p=this.getNpmArgs(c,d),y=[i,(l=t.options)==null?void 0:l.nodeOptions].filter(g=>g).join(" ");return await new Promise((g,T)=>{a=(0,Lr.spawn)(o,p,{cwd:t.cwd,stdio:["inherit","pipe","pipe"],...Br.default.platform()==="win32"&&{shell:!0},env:{...process.stdout.isTTY&&{FORCE_COLOR:"1"},...process.env,...y&&{NODE_OPTIONS:y},LAGE_PACKAGE_NAME:t.packageName,LAGE_TASK:t.task,LAGE_WEIGHT:String(s)}});let b=!1,_=f=>{var W,ee,w;if(a==null||a.off("exit",_),a==null||a.off("error",_),!b){if(b=!0,(W=a==null?void 0:a.stdout)==null||W.destroy(),(ee=a==null?void 0:a.stderr)==null||ee.destroy(),(w=a==null?void 0:a.stdin)==null||w.destroy(),f===0)return g({exitCode:f});T({exitCode:f,error:new Error(`NPM Script Runner: ${o} ${p.join(" ")} exited with code ${f}`)})}},{pid:S}=a;process.stdout.write(`Running ${[o,...p].join(" ")}, pid: ${S}
`);let P=a.stdout,q=a.stderr;P.pipe(process.stdout),q.pipe(process.stderr),a.on("exit",_),a.on("error",()=>_(1))})}constructor(e){Pt(this,"options",void 0),this.options=e}};Pt(J,"gracefulKillTimeout",2500)});var Mt=m(ke=>{"use strict";Object.defineProperty(ke,"__esModule",{value:!0});Object.defineProperty(ke,"WorkerRunner",{enumerable:!0,get:function(){return Q}});var Gr=require("url");function Tt(r,e,t){return e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}var Q=class{async shouldRun(e){let t=await this.getScriptModule(e);return typeof t.shouldRun=="function"?await t.shouldRun(e)&&(e.shouldRun??!0):e.shouldRun??!0}async run(e){let{target:t,weight:s,abortSignal:n}=e,{taskArgs:i}=this.options,o=await this.getScriptModule(t),u=typeof o.run=="function"?o.run:typeof o.default=="function"?o.default:o;if(typeof u!="function")throw new Error("WorkerRunner: worker script must export a function; you likely need to use `module.exports = function() {...}`");return await u({target:t,weight:s,taskArgs:i,abortSignal:n})}async getScriptModule(e){var n,i;let t=((n=e.options)==null?void 0:n.worker)??((i=e.options)==null?void 0:i.script);if(!t)throw new Error('WorkerRunner: "script" configuration is required - e.g. { type: "worker", script: "./worker.js" }');let s=t;return s.startsWith("file://")||(s=(0,Gr.pathToFileURL)(s).toString()),await import(s)}constructor(e){Tt(this,"options",void 0),this.options=e}};Tt(Q,"gracefulKillTimeout",2500)});var be=m(Pe=>{"use strict";Object.defineProperty(Pe,"__esModule",{value:!0});Object.defineProperty(Pe,"NoOpRunner",{enumerable:!0,get:function(){return ve}});var ve=class{async shouldRun(){return!0}async run(){}}});var Ot=m(Te=>{"use strict";Object.defineProperty(Te,"__esModule",{value:!0});Object.defineProperty(Te,"sortTargetsByPriority",{enumerable:!0,get:function(){return Ur}});function Ur(r){return r.sort((e,t)=>(t.priority??0)-(e.priority??0))}});var N=m(Me=>{"use strict";Object.defineProperty(Me,"__esModule",{value:!0});function zr(r,e){for(var t in e)Object.defineProperty(r,t,{enumerable:!0,get:Object.getOwnPropertyDescriptor(e,t).get})}zr(Me,{get getPackageAndTask(){return Vr},get getStagedTargetId(){return Qr},get getStartTargetId(){return Jr},get getTargetId(){return Hr}});function Hr(r,e){return`${typeof r=="string"?r:""}#${e}`}function Vr(r){if(r.startsWith("\u0394"))return{packageName:void 0,task:r.slice(1)};if(r.includes("#")){let e=r.split("#");return r.startsWith("#")||e[0]==="//"?{packageName:void 0,task:e[1]}:{packageName:e[0],task:e[1]}}else return{packageName:void 0,task:r}}var Xr="__start";function Jr(){return Xr}function Qr(r){return`\u0394${r}`}});var Se=m(Oe=>{"use strict";Object.defineProperty(Oe,"__esModule",{value:!0});Object.defineProperty(Oe,"detectCycles",{enumerable:!0,get:function(){return Yr}});function Yr(r){let e=new Map;for(let[t]of r.entries())if(!e.has(t)){let s=Zr(r,e,t);if(s.length>0)return{hasCycle:!0,cycle:s}}return{hasCycle:!1}}var Zr=(r,e,t)=>{let s=[{node:t,traversing:!1}];for(;s.length>0;){let n=s[s.length-1];if(n.traversing)e.set(n.node,!1),s.pop();else{if(e.has(n.node))if(e.get(n.node)){let o=s.filter(u=>u.traversing).map(u=>u.node);return o.slice(o.indexOf(n.node))}else{s.pop();continue}e.set(n.node,!0),s[s.length-1]={...n,traversing:!0};let i=r.get(n.node);if(!i)throw new Error(`Could not find node "${n.node}" in the graph`);s.push(...[...i.dependents].map(o=>({node:o,traversing:!1})))}}return[]}});var St=m(Y=>{"use strict";Object.defineProperty(Y,"__esModule",{value:!0});Y.getPackageDependencies=void 0;function es(r,e){var s,n,i,o;let t=((s=r.dependencies)==null?void 0:s[e])||((n=r.devDependencies)==null?void 0:n[e])||((i=r.peerDependencies)==null?void 0:i[e])||((o=r.optionalDependencies)==null?void 0:o[e]);return t?!t.startsWith("npm:")&&!t.startsWith("file:"):!1}function ts(r,e,t={withDevDependencies:!0}){let s=[];if(r.dependencies)for(let i of Object.keys(r.dependencies))i!==r.name&&e.has(i)&&s.push(i);if(r.devDependencies&&t.withDevDependencies)for(let i of Object.keys(r.devDependencies))i!==r.name&&e.has(i)&&s.push(i);if(r.peerDependencies&&t.withPeerDependencies)for(let i of Object.keys(r.peerDependencies))i!==r.name&&e.has(i)&&s.push(i);if(r.optionalDependencies&&t.withOptionalDependencies)for(let i of Object.keys(r.optionalDependencies))i!==r.name&&e.has(i)&&s.push(i);return s.filter(i=>es(r,i))}Y.getPackageDependencies=ts});var Wt=m(Z=>{"use strict";Object.defineProperty(Z,"__esModule",{value:!0});Z.createDependencyMap=void 0;var rs=St();function ss(r,e={withDevDependencies:!0,withPeerDependencies:!1}){let t={dependencies:new Map,dependents:new Map},s=new Set(Object.keys(r));for(let[n,i]of Object.entries(r)){let o=(0,rs.getPackageDependencies)(i,s,e);for(let u of o)t.dependencies.has(n)||t.dependencies.set(n,new Set),t.dependencies.get(n).add(u),t.dependents.has(u)||t.dependents.set(u,new Set),t.dependents.get(u).add(n)}return t}Z.createDependencyMap=ss});var Et=m(Re=>{"use strict";Object.defineProperty(Re,"__esModule",{value:!0});Object.defineProperty(Re,"expandDepSpecs",{enumerable:!0,get:function(){return ns}});var L=N();function ns(r,e){let t=[],s=(o,u)=>{t.push([o,u])},n=(o,u)=>u?i.filter(c=>{let{task:a,packageName:d}=c;return a===o&&u.some(p=>p===d)}).map(c=>c.id):i.filter(c=>c.task===o).map(c=>c.id),i=[...r.values()];for(let o of i){let{depSpecs:u,packageName:c,id:a}=o;if(t.push([(0,L.getStartTargetId)(),a]),!(!u||u.length===0))for(let d of u)if(d.includes("#")){let{packageName:p,task:y}=(0,L.getPackageAndTask)(d),k=(0,L.getTargetId)(p,y);s(k,a)}else if(d.startsWith("^^")&&c){let p=d.substring(2),y=[...Rt(c,e)??[]],k=n(p,y);for(let v of k)s(v,a)}else if(d.startsWith("^")&&c){let p=d.substring(1),y=[...e.dependencies.get(c)??[]],k=n(p,y);for(let v of k)s(v,a)}else if(c){let p=d;r.has((0,L.getTargetId)(c,p))&&s((0,L.getTargetId)(c,p),a)}else{if(d.startsWith("^"))throw new Error(`invalid pipeline config detected: ${o.id}, packageName: ${c}, dep: ${d}`);{let y=n(d);for(let k of y)s(k,a)}}}return t}var We=new Map;function Rt(r,e){let t=We.get(r);if(t)return t==="walk-in-progress"?new Set:t;{We.set(r,"walk-in-progress");let s=[...e.dependencies.get(r)??[]],n=new Set(s);for(let i of s)for(let o of Rt(i,e))n.add(o);return We.set(r,n),n}}});var xt=m(Ee=>{"use strict";Object.defineProperty(Ee,"__esModule",{value:!0});Object.defineProperty(Ee,"prioritize",{enumerable:!0,get:function(){return us}});function is(r){let e=[];for(let[t,s]of r)s.dependencies.length===0&&e.push(t);return e}function os(r){return new Map([...r.entries()].map(([e,t])=>[e,new Set(t.dependencies)]))}function as(r,e){let t=[],s=os(r),n=[...e];for(;n.length>0;){let i=n.pop();t.unshift(i),r.get(i).dependents.forEach(u=>{let c=s.get(u);c.delete(i),c.size===0&&n.push(u)})}return t}function us(r){let e=new Map,t=is(r),s=as(r,t);for(let n of s){let i=r.get(n),o=i.priority||0,u=i.dependents.map(d=>{let p=e.get(d);if(p===void 0)throw new Error(`Expected to have already computed the cumulative priority for node ${d}`);return p}),c=Math.max(...u,0),a=o+c;e.set(n,a)}for(let n of r.values()){let i=e.get(n.id);if(i===void 0)throw new Error(`Expected to have already computed the cumulative priority for node ${n.id}`);n.priority=i}}});var qe=m(De=>{"use strict";Object.defineProperty(De,"__esModule",{value:!0});Object.defineProperty(De,"TargetGraphBuilder",{enumerable:!0,get:function(){return Ie}});var xe=N(),cs=xt(),ds=Se();function ps(r,e,t){return e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}var Ie=class r{addTarget(e){return this.targets.set(e.id,e),this.addDependency((0,xe.getStartTargetId)(),e.id),e}addDependency(e,t){if(this.targets.has(t)){let s=this.targets.get(t);s.dependencies.includes(e)||s.dependencies.push(e)}if(this.targets.has(e)){let s=this.targets.get(e);s.dependents.includes(t)||s.dependents.push(t)}}build(){let e=(0,ds.detectCycles)(this.targets);if(e.hasCycle)throw new Error("Cycles detected in the target graph: "+e.cycle.concat(e.cycle[0]).join(" -> "));return(0,cs.prioritize)(this.targets),{targets:this.targets}}subgraph(e){let t=new r,s=new Set,n=[];for(let i of e)if(this.targets.has(i)){let o=this.targets.get(i);t.addTarget({...o,dependencies:[],dependents:[]}),n.push(i)}for(;n.length>0;){let i=n.shift();if(s.has(i))continue;s.add(i);let o=this.targets.get(i);if(!o)throw new Error("Subgraph builder failed - target not found: "+i);for(let u of o.dependencies)u!==(0,xe.getStartTargetId)()&&(t.targets.has(u)||t.addTarget({...this.targets.get(u),dependencies:[],dependents:[]}),t.addDependency(u,i)),s.has(u)||n.push(u)}return t.build()}constructor(){ps(this,"targets",new Map);let e=(0,xe.getStartTargetId)();this.targets.set(e,{id:e,task:e,cwd:"",label:"Start",hidden:!0,dependencies:[],dependents:[],depSpecs:[],weight:1,priority:0})}}});var It=m(Ae=>{"use strict";Object.defineProperty(Ae,"__esModule",{value:!0});Object.defineProperty(Ae,"getWeight",{enumerable:!0,get:function(){return ls}});function ls(r,e,t){return typeof e=="number"?e:typeof e=="function"?e(r,t):1}});var Fe=m(je=>{"use strict";Object.defineProperty(je,"__esModule",{value:!0});Object.defineProperty(je,"TargetFactory",{enumerable:!0,get:function(){return Ne}});var Ce=N(),Dt=It();function qt(r,e,t){return e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}var Ne=class{getTargetType(e,t){return t.type?t.type:this.packageScripts.has(e)?"npmScript":"noop"}createPackageTarget(e,t,s){let{resolve:n}=this.options,{options:i,deps:o,dependsOn:u,cache:c,inputs:a,priority:d,maxWorkers:p,environmentGlob:y,weight:k}=s,v=n(e),l=this.getTargetType(t,s),g={id:(0,Ce.getTargetId)(e,t),label:`${e} - ${t}`,type:l,packageName:e,task:t,cache:c!==!1,cwd:v,depSpecs:u??o??[],dependencies:[],dependents:[],inputs:a,outputs:l==="noop"?[]:s.outputs,priority:d,maxWorkers:p,environmentGlob:y,weight:1,options:i,shouldRun:!0};return g.weight=(0,Dt.getWeight)(g,k,p),g}createGlobalTarget(e,t){let{root:s}=this.options,{options:n,deps:i,dependsOn:o,cache:u,inputs:c,outputs:a,priority:d,maxWorkers:p,environmentGlob:y,weight:k}=t,{task:v}=(0,Ce.getPackageAndTask)(e),l={id:e,label:e,type:this.getTargetType(v,t),task:v,cache:u!==!1,cwd:s,depSpecs:o??i??[],dependencies:[],dependents:[],inputs:c,outputs:a,priority:d,maxWorkers:p,environmentGlob:y,weight:1,options:n,shouldRun:!0};return l.weight=(0,Dt.getWeight)(l,k,p),l}createStagedTarget(e,t,s){let{root:n}=this.options,{dependsOn:i,priority:o}=t,u={...t.options};switch(t.type){case"noop":break;default:u.taskArgs=u.taskArgs??[],u.taskArgs.push(...s);break}let c=(0,Ce.getStagedTargetId)(e);return{id:c,label:c,type:t.type,task:e,cache:!1,cwd:n,depSpecs:i??[],dependencies:[],dependents:[],inputs:[],outputs:[],priority:o,maxWorkers:1,environmentGlob:[],weight:1,options:u,shouldRun:!0}}constructor(e){qt(this,"options",void 0),qt(this,"packageScripts",void 0),this.options=e,this.packageScripts=new Set;let{packageInfos:t}=e;for(let s of Object.values(t))for(let n of Object.keys(s.scripts??{}))this.packageScripts.add(n)}}});var Ct=m((Sn,At)=>{var Ke=class{constructor(e){this.value=e,this.next=void 0}},Le=class{constructor(){this.clear()}enqueue(e){let t=new Ke(e);this._head?(this._tail.next=t,this._tail=t):(this._head=t,this._tail=t),this._size++}dequeue(){let e=this._head;if(e)return this._head=this._head.next,this._size--,e.value}clear(){this._head=void 0,this._tail=void 0,this._size=0}get size(){return this._size}*[Symbol.iterator](){let e=this._head;for(;e;)yield e.value,e=e.next}};At.exports=Le});var jt=m((Wn,Nt)=>{"use strict";var fs=Ct(),hs=r=>{if(!((Number.isInteger(r)||r===1/0)&&r>0))throw new TypeError("Expected `concurrency` to be a number from 1 and up");let e=new fs,t=0,s=()=>{t--,e.size>0&&e.dequeue()()},n=async(u,c,...a)=>{t++;let d=(async()=>u(...a))();c(d);try{await d}catch{}s()},i=(u,c,...a)=>{e.enqueue(n.bind(null,u,c,...a)),(async()=>(await Promise.resolve(),t<r&&e.size>0&&e.dequeue()()))()},o=(u,...c)=>new Promise(a=>{i(u,a,...c)});return Object.defineProperties(o,{activeCount:{get:()=>t},pendingCount:{get:()=>e.size},clearQueue:{value:()=>{e.clear()}}}),o};Nt.exports=hs});var $t=m((Rn,Bt)=>{var $e=Object.defineProperty,gs=Object.getOwnPropertyDescriptor,ys=Object.getOwnPropertyNames,ms=Object.prototype.hasOwnProperty,_s=(r,e)=>{for(var t in e)$e(r,t,{get:e[t],enumerable:!0})},ws=(r,e,t,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of ys(e))!ms.call(r,n)&&n!==t&&$e(r,n,{get:()=>e[n],enumerable:!(s=gs(e,n))||s.enumerable});return r},ks=r=>ws($e({},"__esModule",{value:!0}),r),Kt={};_s(Kt,{mergician:()=>Lt});Bt.exports=ks(Kt);function Ge(...r){let e={};return r.forEach(t=>{t.forEach(s=>{e[s]=s in e?++e[s]:1})}),e}function vs(...r){return r.reduce((e,t)=>e.filter(Set.prototype.has,new Set(t)))}function Ps(...r){let e=Ge(...r);return Object.keys(e).filter(t=>e[t]>1)}function bs(...r){let e=Ge(...r);return Object.keys(e).filter(t=>e[t]<r.length)}function Ts(...r){let e=Ge(...r);return Object.keys(e).filter(t=>e[t]===1)}function Ms(r,e=!1){let t=Object.getOwnPropertyNames(r);if(e)for(let s in r)!t.includes(s)&&t.push(s);return t}function Be(r){return typeof r=="object"&&r!==null&&!Array.isArray(r)}function Ft(r){if(!Be(r))return!1;let e=["writable","enumerable","configurable"].some(i=>i in r),t=["get","set"].some(i=>typeof r[i]=="function"),s=["get","set"].every(i=>i in r),n="value"in r&&e||t&&(s||e);if(n){let i=["configurable","get","set","enumerable","value","writable"];n=Object.keys(r).some(o=>!(o in i))}return n}var j={onlyKeys:[],skipKeys:[],onlyCommonKeys:!1,onlyUniversalKeys:!1,skipCommonKeys:!1,skipUniversalKeys:!1,invokeGetters:!1,skipSetters:!1,appendArrays:!1,prependArrays:!1,dedupArrays:!1,sortArrays:!1,hoistEnumerable:!1,hoistProto:!1,skipProto:!1,filter:Function.prototype,beforeEach:Function.prototype,afterEach:Function.prototype,onCircular:Function.prototype};function Lt(r,...e){let t=arguments.length===1?arguments[0]:{},s={...j,...t},n=new Map,i=new Map,o=typeof s.sortArrays=="function"?s.sortArrays:void 0,u=new WeakMap,c=0;function a(p){return Ms(p,s.hoistEnumerable)}function d(...p){let y;p.length>1&&(s.onlyCommonKeys?y=Ps(...p.map(l=>a(l))):s.onlyUniversalKeys?y=vs(...p.map(l=>a(l))):s.skipCommonKeys?y=Ts(...p.map(l=>a(l))):s.skipUniversalKeys&&(y=bs(...p.map(l=>a(l))))),!y&&s.onlyKeys.length&&(y=s.onlyKeys),y&&y!==s.onlyKeys&&s.onlyKeys.length&&(y=y.filter(l=>s.onlyKeys.includes(l)));let k=p.reduce((l,g)=>{u.set(g,l);let T=y||a(g);s.skipKeys.length&&(T=T.filter(b=>s.skipKeys.indexOf(b)===-1));for(let b=0;b<T.length;b++){let _=T[b],S=l[_],P={configurable:!0,enumerable:!0};if(!(_ in g))continue;let q=!1,f=g[_],W=Object.getOwnPropertyDescriptor(g,_);if(W&&typeof W.set=="function"&&typeof W.get!="function"){s.skipSetters||Object.defineProperty(l,_,W);continue}if(s.filter!==j.filter){let w=s.filter({depth:c,key:_,srcObj:g,srcVal:f,targetObj:l,targetVal:S});if(w!==void 0&&!w)continue}if(s.beforeEach!==j.beforeEach){let w=s.beforeEach({depth:c,key:_,srcObj:g,srcVal:f,targetObj:l,targetVal:S});w!==void 0&&(q=!0,f=w)}if(typeof f=="object"&&f!==null&&u.has(g[_])){let w=s.onCircular({depth:c,key:_,srcObj:g,srcVal:g[_],targetObj:l,targetVal:S});if(w===void 0){f=u.get(g[_]),l[_]=f;continue}q=!0,f=w}if(Array.isArray(f)){if(f=[...f],Array.isArray(S)&&(s.appendArrays?f=[...S,...f]:s.prependArrays&&(f=[...f,...S])),s.dedupArrays)if(s.afterEach!==j.afterEach)f=[...new Set(f)];else{let w=n.get(l);w&&!w.includes(_)?w.push(_):n.set(l,[_])}if(s.sortArrays)if(s.afterEach!==j.afterEach)f=f.sort(o);else{let w=i.get(l);w&&!w.includes(_)?w.push(_):i.set(l,[_])}}else f instanceof Date?f=new Date(f):Be(f)&&(!q||!Ft(f))&&(c++,Be(S)?f=d(S,f):f=d(f),c--);if(s.afterEach!==j.afterEach){let w=s.afterEach({depth:c,key:_,mergeVal:f,srcObj:g,targetObj:l});w!==void 0&&(q=!0,f=w)}if(q){let w=Ft(f)?f:{configurable:!0,enumerable:!0,value:f,writable:!0};Object.defineProperty(l,_,w);continue}if(W){let{configurable:w,enumerable:Yt,get:et,set:tt,writable:Zt}=W;Object.assign(P,{configurable:w,enumerable:Yt}),typeof et=="function"&&(s.invokeGetters?P.value=f:P.get=et),!s.skipSetters&&typeof tt=="function"&&!Object.hasOwnProperty.call(P,"value")&&(P.set=tt),!P.get&&!P.set&&(P.writable=!!Zt)}!P.get&&!P.set&&!("value"in P)&&(P.value=f,P.writable=W&&"writable"in W?W.writable:!0),Object.defineProperty(l,_,P)}return l},{});for(let[l,g]of n.entries())for(let T of g){let b=Object.getOwnPropertyDescriptor(l,T),{configurable:_,enumerable:S,writable:P}=b;Object.defineProperty(l,T,{configurable:_,enumerable:S,value:[...new Set(l[T])],writable:P!==void 0?P:!0})}for(let[l,g]of i.entries())for(let T of g)l[T].sort(o);let v=k;if(!s.skipProto){let l=p.reduce((g,T)=>{let b=Object.getPrototypeOf(T);return b&&b!==Object.prototype&&g.push(b),g},[]);if(l.length){let g=d(...l);s.hoistProto?v=d(g,k):v=Object.create(g,Object.getOwnPropertyDescriptors(k))}}return v}return arguments.length===1?function(...p){return arguments.length===1?Lt({...s,...p[0]}):d(...p)}:d(...arguments)}});var Ut=m(ze=>{"use strict";Object.defineProperty(ze,"__esModule",{value:!0});Object.defineProperty(ze,"WorkspaceTargetGraphBuilder",{enumerable:!0,get:function(){return Ue}});var Os=Wt(),D=N(),Ss=Et(),Ws=Gt(require("path")),Rs=qe(),Es=Fe(),xs=Gt(jt());function x(r,e,t){return e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function Gt(r){return r&&r.__esModule?r:{default:r}}var{mergician:Is}=$t(),Ds=50,Ue=class{async addTargetConfig(e,t={},s){if(e.startsWith("//")||e.startsWith("#")){let n=this.determineFinalTargetConfig(e,t),i=this.targetFactory.createGlobalTarget(e,n);this.graphBuilder.addTarget(i),this.hasRootTarget=!0,this.processStagedConfig(i,t,s)}else if(e.includes("#")){let{packageName:n,task:i}=(0,D.getPackageAndTask)(e),o=this.determineFinalTargetConfig(e,t),u=this.targetFactory.createPackageTarget(n,i,o);this.graphBuilder.addTarget(u),this.processStagedConfig(u,t,s)}else{let n=Object.keys(this.packageInfos);for(let i of n){let o=e,u=this.determineFinalTargetConfig((0,D.getTargetId)(i,o),t),c=this.targetFactory.createPackageTarget(i,o,u);this.graphBuilder.addTarget(c),this.processStagedConfig(c,t,s)}}}determineFinalTargetConfig(e,t){let s=t;if(this.enableTargetConfigMerging&&this.targetConfigMap.has(e)){let n=this.targetConfigMap.get(e);s=this.deepCloneTargetConfig(n,t)}return this.targetConfigMap.set(e,s),s}async processStagedConfig(e,t,s){if(typeof t.stagedTarget>"u"||typeof s>"u"||s.length===0||s.length>(t.stagedTarget.threshold??Ds))return;this.hasStagedTarget=!0,e.type="noop",e.cache=!1,e.shouldRun=!1;let n=(0,D.getStagedTargetId)(e.task),i=this.graphBuilder.targets.has(n)?this.graphBuilder.targets.get(n):this.targetFactory.createStagedTarget(e.task,t.stagedTarget,s);this.graphBuilder.addTarget(i);let o=new Set(i.dependencies);for(let u of e.dependencies)o.add(u);if(i.dependencies=Array.from(o),e.dependents.length>0)throw new Error(`Parent target ${e.id} cannot have dependents when it has a staged target while running with a --since flag`)}shouldRun(e,t){return typeof e.shouldRun=="function"?e.shouldRun(t):!0}async build(e,t,s){let n=(0,Ss.expandDepSpecs)(this.graphBuilder.targets,this.dependencyMap);for(let[a,d]of n)this.graphBuilder.addDependency(a,d);let i=[];for(let a of e){if(t)for(let d of t)i.push((0,D.getTargetId)(d,a));else for(let d of Object.keys(this.packageInfos))i.push((0,D.getTargetId)(d,a));if(this.hasRootTarget){let d=(0,D.getTargetId)(void 0,a);this.graphBuilder.targets.has(d)&&i.push(d)}if(this.hasStagedTarget){let d=(0,D.getStagedTargetId)(a);this.graphBuilder.targets.has(d)&&i.push(d)}}if(s){for(let a of s)if(a.package){let d=(0,D.getTargetId)(a.package,a.task),p=this.graphBuilder.targets.get(d);p&&(p.priority=p.priority?Math.max(p.priority,a.priority):a.priority)}}let o=this.graphBuilder.subgraph(i),u=(0,xs.default)(8),c=[];for(let a of o.targets.values()){let d=this.targetConfigMap.get(a.id);d&&c.push(u(async()=>{a.shouldRun=await this.shouldRun(d,a)}))}return await Promise.all(c),{targets:o.targets}}constructor(e,t,s){x(this,"packageInfos",void 0),x(this,"enableTargetConfigMerging",void 0),x(this,"dependencyMap",void 0),x(this,"graphBuilder",void 0),x(this,"targetFactory",void 0),x(this,"hasRootTarget",void 0),x(this,"hasStagedTarget",void 0),x(this,"targetConfigMap",void 0),x(this,"deepCloneTargetConfig",void 0),this.packageInfos=t,this.enableTargetConfigMerging=s,this.hasRootTarget=!1,this.hasStagedTarget=!1,this.targetConfigMap=new Map,this.deepCloneTargetConfig=Is({appendArrays:!0,onCircular:()=>{throw new Error("Circular object reference detected in TargetConfig")}}),this.dependencyMap=(0,Os.createDependencyMap)(t,{withDevDependencies:!0,withPeerDependencies:!1}),this.graphBuilder=new Rs.TargetGraphBuilder,this.targetFactory=new Es.TargetFactory({root:e,packageInfos:t,resolve(n){try{return Ws.default.dirname(t[n].packageJsonPath)}catch{throw new Error(`Cannot open package.json file for ${n}`)}}})}}});var zt=m(He=>{"use strict";Object.defineProperty(He,"__esModule",{value:!0});Object.defineProperty(He,"removeNodes",{enumerable:!0,get:function(){return qs}});async function qs(r,e){let t=new Map;r.forEach(n=>t.set(n.id,n));let s=new Map;for(let n of r)if(await e(n)){t.delete(n.id);for(let o of n.dependencies)s.has(n.id)||s.set(n.id,new Set),s.get(n.id).add(o)}for(let n of t.values()){let i=new Set(n.dependencies);for(let o of n.dependencies)s.has(o)&&s.get(o).forEach(u=>i.add(u));n.dependencies=Array.from(i).filter(o=>t.has(o))}return Array.from(t.values())}});var Ht=m(Ve=>{"use strict";Object.defineProperty(Ve,"__esModule",{value:!0});Object.defineProperty(Ve,"transitiveReduction",{enumerable:!0,get:function(){return As}});function As(r){let e=new Map,t=new Map;r.forEach(i=>{e.set(i.id,i),t.set(i.id,new Map),i.dependencies.forEach(o=>{t.get(i.id).set(o,!0)})});function s(i,o,u){var d;if(i===o)return!0;if(u.has(i))return!1;if(u.add(i),(d=t.get(i))!=null&&d.has(o))return t.get(i).get(o);let c=e.get(i);if(!c)return!1;let a=c.dependencies.some(p=>s(p,o,u));return t.get(i).set(o,a),a}return r.map(i=>({...i,dependencies:i.dependencies.filter(o=>{let u=new Set;return!i.dependencies.some(c=>c!==o&&s(c,o,u))})}))}});var Vt=m(Je=>{"use strict";Object.defineProperty(Je,"__esModule",{value:!0});function Cs(r,e){for(var t in e)Object.defineProperty(r,t,{enumerable:!0,get:Object.getOwnPropertyDescriptor(e,t).get})}Cs(Je,{get TargetFactory(){return Ls.TargetFactory},get TargetGraphBuilder(){return Ks.TargetGraphBuilder},get WorkspaceTargetGraphBuilder(){return Fs.WorkspaceTargetGraphBuilder},get detectCycles(){return js.detectCycles},get getPackageAndTask(){return Xe.getPackageAndTask},get getStartTargetId(){return Xe.getStartTargetId},get getTargetId(){return Xe.getTargetId},get removeNodes(){return Bs.removeNodes},get sortTargetsByPriority(){return Ns.sortTargetsByPriority},get transitiveReduction(){return $s.transitiveReduction}});var Ns=Ot(),Xe=N(),js=Se(),Fs=Ut(),Ks=qe(),Ls=Fe(),Bs=zt(),$s=Ht()});var Jt=m(Ye=>{"use strict";Object.defineProperty(Ye,"__esModule",{value:!0});Object.defineProperty(Ye,"TargetRunnerPicker",{enumerable:!0,get:function(){return Qe}});var Xt=Hs(require("path")),Gs=Vt(),Us=require("url");function zs(r,e,t){return e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function Hs(r){return r&&r.__esModule?r:{default:r}}var Qe=class{async pick(e){if(e.id===(0,Gs.getStartTargetId)())return new(await Promise.resolve().then(()=>or(be()))).NoOpRunner;if(e.type||(e.type="npmScript"),this.options[e.type]){let t=this.options[e.type],{script:s,options:n}=t,i=s;i.startsWith("file://")||(i=(0,Us.pathToFileURL)(i).toString());let o=await import(i),u=Xt.default.basename(s),c=u.replace(Xt.default.extname(u),""),a=typeof o[c]=="function"?o[c]:typeof o.default=="function"?o.default:typeof o.default[c]=="function"?o.default[c]:o;return new a(n)}throw new Error(`No runner found for target ${e.id}`)}constructor(e){zs(this,"options",void 0),this.options=e}}});var Qt=m(Ze=>{"use strict";Object.defineProperty(Ze,"__esModule",{value:!0});function Vs(r,e){for(var t in e)Object.defineProperty(r,t,{enumerable:!0,get:Object.getOwnPropertyDescriptor(e,t).get})}Vs(Ze,{get NoOpRunner(){return Qs.NoOpRunner},get NpmScriptRunner(){return Xs.NpmScriptRunner},get TargetRunnerPicker(){return Ys.TargetRunnerPicker},get WorkerRunner(){return Js.WorkerRunner}});var Xs=bt(),Js=Mt(),Qs=be(),Ys=Jt()});Object.defineProperty(exports,"__esModule",{value:!0});var Zs=vt(),en=Qt(),tn=require("worker_threads");async function rn(r){let{runners:e}=r,t=new en.TargetRunnerPicker(e);return{options:r,runnerPicker:t}}(async()=>{let{runnerPicker:r}=await rn(tn.workerData);async function e(t,s){let n;return n=await(await r.pick(t.target)).run({target:t.target,weight:0,abortSignal:s}),{skipped:!1,hash:void 0,value:n}}(0,Zs.registerWorker)(e)})();
/*! Bundled license information:

mergician/dist/mergician.cjs:
  (*!
   * mergician
   * v2.0.2
   * https://jhildenbiddle.github.io/mergician/
   * (c) 2022-2024 John Hildenbiddle
   * MIT license
   *)
  (**
   * @typedef {Object} MergicianOptions
   * @property {string[]} [onlyKeys] - Exclusive array of keys to be merged
   * (others are skipped)
   * @property {string[]} [skipKeys] - Array of keys to skip (others are
   * merged)
   * @property {boolean} [onlyCommonKeys=false] - Merge only keys found
   * in multiple objects (ignore single occurrence keys)
   * @property {boolean} [onlyUniversalKeys=false] - Merge only keys
   * found in all objects
   * @property {boolean} [skipCommonKeys=false] - Skip keys found in
   * multiple objects (merge only single occurrence keys)
   * @property {boolean} [skipUniversalKeys=false] - Skip keys found in
   * all objects (merge only common keys)
   * @property {boolean} [invokeGetters=false] - Invoke "getter" methods
   * and merge returned values
   * @property {boolean} [skipSetters=false] - Skip "setter" methods
   * during merge
   * @property {boolean} [appendArrays=false] - Merge array values at
   * the end of existing arrays
   * @property {boolean} [prependArrays=false] - Merge array values at
   * the beginning of existing arrays
   * @property {boolean} [dedupArrays=false] - Remove duplicate array
   * values in new merged object
   * @property {boolean|function} [sortArrays=false] - Sort array values
   * in new merged object
   * @property {boolean} [hoistEnumerable=false] - Merge enumerable
   * prototype properties as direct properties of merged object
   * @property {boolean} [hoistProto=false] - Merge custom prototype
   * properties as direct properties of merged object
   * @property {boolean} [skipProto=false] - Skip merging of custom
   * prototype properties
   * @property {filterCallback} [filter] - Callback used to conditionally merge
   * or skip a property. Return a "truthy" value to merge or a "falsy" value to
   * skip. Return no value to proceed according to other option values.
   * @property {beforeEachCallback} [beforeEach] - Callback used for
   * inspecting/modifying properties before merge. Return value is used as value
   * to merge.
   * @property {afterEachCallback} [afterEach] - Callback used for
   * inspecting/modifying properties after merge. Return value is used as merged
   * value.
   * @property {onCircularCallback} [onCircular] - Callback used for handling
   * circular object references during merge
   * @preserve
   *)
  (**
   * @callback filterCallback
   * @param {callbackData} callbackData
   * @preserve
   *)
  (**
   * @callback beforeEachCallback
   * @param {callbackData} callbackData
   * @preserve
   *)
  (**
   * @callback afterEachCallback
   * @param {afterEachCallbackData} callbackData
   * @preserve
   *)
  (**
   * @callback onCircularCallback
   * @param {callbackData} callbackData
   * @preserve
   *)
  (**
   * @typedef {Object} callbackData
   * @property {number} depth - Nesting level of the key being processed
   * @property {string} key - Object key being processed
   * @property {object} srcObj - Object containing the source value
   * @property {any} srcVal - Source object’s property value
   * @property {object} targetObj - New merged object
   * @property {any} targetVal - New merged object’s current property value
   * @preserve
   *)
  (**
   * @typedef {Object} afterEachCallbackData
   * @property {number} depth - Nesting level of the key being processed
   * @property {string} key - Object key being processed
   * @property {any} mergeVal - New merged value
   * @property {object} srcObj - Object containing the source value
   * @property {object} targetObj - New merged object
   * @preserve
   *)
  (**
   * @description Deep (recursive) object merging with support for descriptor
   * values, accessor functions, custom prototypes, and advanced options for
   * customizing the merge process.
   *
   * @example
   * // Custom merge options
   * const mergedObj = mergician({
   *   // Options
   * })(obj1, obj2, obj3);
   *
   * // Custom merge function
   * const customMerge = mergician({
   *   // Options
   * });
   * const customMergeObj = customMerge(obj1, obj2, obj3);
   *
   * @overload
   * @param {MergicianOptions} options
   * @returns {function} New merge function with options set as defaults
   * @preserve
   *)
  (**
   * @description Deep (recursive) object merging with support for descriptor
   * values, accessor functions, custom prototypes, and advanced options for
   * customizing the merge process.
   *
   * @example
   * // Clone with default options
   * const clonedObj = mergician({}, obj1);
   *
   * // Merge with default options
   * const mergedObj = mergician(obj1, obj2, obj3);
   *
   * @overload
   * @param {...object} objects
   * @returns {object} New merged object
   * @preserve
   *)
  (**
   * @description Deep (recursive) object merging with support for descriptor
   * values, accessor functions, custom prototypes, and advanced options for
   * customizing the merge process.
   *
   * @example
   * // Clone with default options
   * const clonedObj = mergician({}, obj1);
   *
   * // Merge with default options
   * const mergedObj = mergician(obj1, obj2, obj3);
   *
   * @example
   * // Custom merge options
   * const mergedObj = mergician({
   *   // Options
   * })(obj1, obj2, obj3);
   *
   * // Custom merge function
   * const customMerge = mergician({
   *   // Options
   * });
   * const customMergeObj = customMerge(obj1, obj2, obj3);
   *
   * @param {MergicianOptions} optionsOrObject
   * @param {...object} [objects]
   * @returns {function|object} New merge function with options set as defaults
   * (single argument) or new merged object (multiple arguments)
   * @preserve
   *)
*/
//# sourceMappingURL=singleTargetWorker.js.map
